## Non-parametric Bayes

```{r}
setwd("~/Documents/code/nonparametric-bayes/inst/examples/BUGS/")
knit("setup.Rmd")
```


```{r gp-priors}
#inv gamma has mean b / (a - 1) (assuming a>1) and variance b ^ 2 / ((a - 2) * (a - 1) ^ 2) (assuming a>2)
s2.p <- c(5,5)  
d.p = c(10, 1/0.1)
```


Estimate the Gaussian Process (nonparametric Bayesian fit)

```{r}
gp <- gp_mcmc(obs$x, y=obs$y, n=1e5, s2.p = s2.p, d.p = d.p)
gp_dat <- gp_predict(gp, x_grid)
          
```


Show traces and posteriors against priors

```{r}
plots <- summary_gp_mcmc(gp)
plots[[1]]
plots[[2]]
```


```{r}
# Summarize the GP model
tgp_dat <- 
    data.frame(  x = x_grid, 
                 y = gp_dat$E_Ef, 
                 ymin = gp_dat$E_Ef - 2 * sqrt(gp_dat$E_Vf), 
                 ymax = gp_dat$E_Ef + 2 * sqrt(gp_dat$E_Vf) )


  true_means <- sapply(x_grid, f, 0, p)
  alt_means <- sapply(x_grid, alt$f, 0, alt$p)
  est_means <- sapply(x_grid, est$f, 0, est$p)
  par_bayes_means <- sapply(x_grid, f, 0, bayes_pars)



models <- data.frame(x=x_grid, GP=tgp_dat$y, True=true_means, 
                     MLE=est_means, Ricker.MLE=alt_means, 
                     Parametric.Bayes = par_bayes_means)

models <- melt(models, id="x")
names(models) <- c("x", "method", "value")

plot_gp <- ggplot(tgp_dat) + geom_ribbon(aes(x,y,ymin=ymin,ymax=ymax), fill="gray80") +
    geom_line(data=models, aes(x, value, col=method), lwd=2, alpha=0.8) + 
    geom_point(data=obs, aes(x,y), alpha=0.8) + 
    xlab(expression(X[t])) + ylab(expression(X[t+1])) +
    scale_colour_manual(values=cbPalette) 
print(plot_gp)

```